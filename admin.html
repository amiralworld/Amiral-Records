<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin Panel</title>
  <link rel="icon" type="image/png" href="fav2.png">
  <meta name="robots" content="noindex, nofollow">

  <style>
    :root{
      --bg0:#000;
      --bg1:#050505;
      --bg2:#020202;
      --red:#b30000;
      --red2:#ff1a1a;
      --txt: rgba(255,255,255,.82);
      --mut: rgba(255,255,255,.56);
      --line: rgba(255,255,255,.12);
      --glow1: rgba(255,0,40,.30);
      --glow2: rgba(255,0,0,.16);
    }

    *{ box-sizing:border-box; }
    html, body{ height:100%; }
    body{
      margin:0;
      overflow:hidden;
      background: var(--bg0);
      color: var(--txt);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Helvetica Neue", Helvetica, sans-serif;
    }

    .stage{
      position:relative;
      width:100vw;
      height:100vh;
      isolation:isolate;
      background:
        radial-gradient(1000px 560px at 50% 46%, rgba(255,255,255,.055), rgba(0,0,0,0) 60%),
        radial-gradient(760px 420px at 50% 50%, rgba(255,0,0,.09), rgba(255,0,0,0) 62%),
        radial-gradient(1200px 900px at 50% 55%, rgba(0,0,0,0) 46%, rgba(0,0,0,.74) 74%, rgba(0,0,0,.95) 100%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
    }

    .stage::before{
      content:"";
      position:absolute; inset:0;
      pointer-events:none;
      z-index:0;
      background:
        radial-gradient(520px 120px at 50% 7%, rgba(179,0,0,.24), rgba(179,0,0,0) 72%),
        radial-gradient(360px 90px at 42% 9%, rgba(255,0,0,.14), rgba(255,0,0,0) 75%),
        radial-gradient(420px 110px at 58% 9%, rgba(255,0,0,.12), rgba(255,0,0,0) 78%);
      mix-blend-mode: screen;
      filter: blur(0.6px);
      opacity:.85;
    }

    .center{
      position:absolute; inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      z-index:2;
      padding: 24px;
      animation: fadeIn 0.8s ease-out;
      overflow-y: auto;
    }
    @keyframes fadeIn{
      from{ opacity:0; transform:translateY(20px); }
      to{ opacity:1; transform:translateY(0); }
    }

    .login-card{
      width:min(420px, 90vw);
      border-radius:20px;
      border:1px solid rgba(255,255,255,.12);
      background:
        radial-gradient(400px 200px at 50% 0%, rgba(255,0,0,.10), transparent 70%),
        linear-gradient(180deg, rgba(12,12,12,.95), rgba(0,0,0,.90));
      box-shadow: 
        0 24px 90px rgba(0,0,0,.8),
        0 0 0 1px rgba(255,0,0,.08) inset;
      padding: 36px 32px;
      backdrop-filter: blur(2px);
    }

    .dashboard-card{
      width:min(1200px, 95vw);
      max-height:90vh;
      border-radius:20px;
      border:1px solid rgba(255,255,255,.12);
      background:
        radial-gradient(600px 300px at 50% 0%, rgba(255,0,0,.10), transparent 70%),
        linear-gradient(180deg, rgba(12,12,12,.95), rgba(0,0,0,.90));
      box-shadow: 
        0 24px 90px rgba(0,0,0,.8),
        0 0 0 1px rgba(255,0,0,.08) inset;
      padding: 32px;
      backdrop-filter: blur(2px);
      overflow-y: auto;
    }

    .login-card h1{
      margin:0 0 8px 0;
      font-size:18px;
      letter-spacing:.20em;
      text-transform:uppercase;
      font-weight:900;
      color: rgba(255,255,255,.95);
      text-shadow: 0 0 20px rgba(255,0,0,.25);
    }

    .login-card .subtitle{
      margin:0 0 28px 0;
      font-size:11px;
      letter-spacing:.12em;
      color: rgba(255,255,255,.55);
      text-transform:uppercase;
    }

    .form-group{
      margin-bottom:20px;
    }

    .form-group label{
      display:block;
      margin-bottom:8px;
      font-size:11px;
      letter-spacing:.14em;
      text-transform:uppercase;
      color: rgba(255,255,255,.70);
      font-weight:700;
    }

    .form-group input{
      width:100%;
      padding:12px 16px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.45);
      color: rgba(255,255,255,.90);
      font-size:14px;
      font-family:inherit;
      transition: all 0.3s ease;
      outline:none;
    }

    .form-group input:focus,
    .form-group textarea:focus{
      border-color: rgba(255,0,0,.35);
      background: rgba(0,0,0,.55);
      box-shadow: 
        0 0 0 2px rgba(255,0,0,.15),
        0 0 20px rgba(255,0,0,.10);
    }

    .form-group textarea{
      width:100%;
      padding:12px 16px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.45);
      color: rgba(255,255,255,.90);
      font-size:14px;
      font-family:inherit;
      transition: all 0.3s ease;
      outline:none;
      resize:vertical;
      min-height:80px;
    }

    .form-group input[type="file"]{
      width:100%;
      padding:12px 16px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.45);
      color: rgba(255,255,255,.90);
      font-size:14px;
      font-family:inherit;
      transition: all 0.3s ease;
      outline:none;
      cursor:pointer;
    }

    .form-group input[type="file"]:focus{
      border-color: rgba(255,0,0,.35);
      background: rgba(0,0,0,.55);
      box-shadow: 
        0 0 0 2px rgba(255,0,0,.15),
        0 0 20px rgba(255,0,0,.10);
    }

    .form-group input[type="number"]{
      width:100%;
      padding:12px 16px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.45);
      color: rgba(255,255,255,.90);
      font-size:14px;
      font-family:inherit;
      transition: all 0.3s ease;
      outline:none;
    }

    .image-preview{
      margin-top:12px;
      width:100%;
      max-width:200px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.12);
      overflow:hidden;
      display:none;
    }

    .image-preview.show{
      display:block;
    }

    .image-preview img{
      width:100%;
      height:auto;
      display:block;
    }

    .edit-form .image-preview{
      max-width:150px;
    }

    .btn{
      width:100%;
      padding:14px 20px;
      border-radius:10px;
      border:none;
      background: linear-gradient(180deg, rgba(255,0,0,.20), rgba(179,0,0,.15));
      border:1px solid rgba(255,0,0,.25);
      color: rgba(255,255,255,.95);
      font-size:12px;
      letter-spacing:.16em;
      text-transform:uppercase;
      font-weight:700;
      cursor:pointer;
      transition: all 0.3s ease;
      margin-top:8px;
    }

    .btn:hover{
      background: linear-gradient(180deg, rgba(255,0,0,.28), rgba(179,0,0,.22));
      border-color: rgba(255,0,0,.40);
      box-shadow: 
        0 0 0 2px rgba(255,0,0,.20),
        0 8px 24px rgba(255,0,0,.25);
      transform: translateY(-2px);
    }

    .btn:active{
      transform: translateY(0);
    }

    .error{
      margin-top:16px;
      padding:12px 16px;
      border-radius:10px;
      background: rgba(255,0,0,.12);
      border:1px solid rgba(255,0,0,.25);
      color: rgba(255,255,255,.90);
      font-size:12px;
      text-align:center;
      display:none;
      animation: shake 0.5s ease;
    }
    @keyframes shake{
      0%,100%{ transform:translateX(0); }
      25%{ transform:translateX(-10px); }
      75%{ transform:translateX(10px); }
    }

    .error.show{
      display:block;
    }

    .dashboard{
      display:none;
    }

    .dashboard.active{
      display:block;
    }

    .dashboard-header{
      margin-bottom:24px;
      padding-bottom:20px;
      border-bottom:1px solid rgba(255,255,255,.12);
    }

    .dashboard-header h2{
      margin:0 0 8px 0;
      font-size:16px;
      letter-spacing:.18em;
      text-transform:uppercase;
      font-weight:900;
      color: rgba(255,255,255,.95);
    }

    .dashboard-header p{
      margin:0;
      font-size:11px;
      color: rgba(255,255,255,.55);
      letter-spacing:.10em;
    }

    .dashboard-content{
      display:grid;
      gap:24px;
    }

    .section{
      border:1px solid rgba(255,255,255,.10);
      border-radius:16px;
      padding:24px;
      background: rgba(0,0,0,.25);
    }

    .section-title{
      margin:0 0 20px 0;
      font-size:14px;
      letter-spacing:.16em;
      text-transform:uppercase;
      font-weight:900;
      color: rgba(255,255,255,.95);
      text-shadow: 0 0 20px rgba(255,0,0,.25);
      padding-bottom:12px;
      border-bottom:1px solid rgba(255,255,255,.12);
    }

    .form-row{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap:16px;
      margin-bottom:16px;
    }

    .btn-secondary{
      padding:10px 18px;
      border-radius:8px;
      border:1px solid rgba(255,255,255,.15);
      background: rgba(255,255,255,.05);
      color: rgba(255,255,255,.85);
      font-size:11px;
      letter-spacing:.12em;
      text-transform:uppercase;
      font-weight:700;
      cursor:pointer;
      transition: all 0.2s ease;
    }

    .btn-secondary:hover{
      background: rgba(255,255,255,.10);
      border-color: rgba(255,255,255,.25);
    }

    .btn-danger{
      padding:8px 14px;
      border-radius:8px;
      border:1px solid rgba(255,0,0,.25);
      background: rgba(255,0,0,.10);
      color: rgba(255,255,255,.85);
      font-size:10px;
      letter-spacing:.10em;
      text-transform:uppercase;
      font-weight:700;
      cursor:pointer;
      transition: all 0.2s ease;
    }

    .btn-danger:hover{
      background: rgba(255,0,0,.20);
      border-color: rgba(255,0,0,.40);
    }

    .btn-edit{
      padding:8px 14px;
      border-radius:8px;
      border:1px solid rgba(255,255,255,.20);
      background: rgba(255,255,255,.08);
      color: rgba(255,255,255,.85);
      font-size:10px;
      letter-spacing:.10em;
      text-transform:uppercase;
      font-weight:700;
      cursor:pointer;
      transition: all 0.2s ease;
    }

    .btn-edit:hover{
      background: rgba(255,255,255,.15);
      border-color: rgba(255,255,255,.30);
    }

    .edit-form{
      display:none;
      margin-top:16px;
      padding:16px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.30);
    }

    .edit-form.active{
      display:block;
    }

    .artists-list{
      display:grid;
      gap:12px;
      margin-top:16px;
    }

    .artist-item{
      padding:16px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.30);
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:16px;
      transition: all 0.2s ease;
    }

    .artist-item:hover{
      border-color: rgba(255,0,0,.20);
      background: rgba(0,0,0,.40);
    }

    .artist-info{
      flex:1;
    }

    .artist-name{
      font-weight:700;
      font-size:13px;
      letter-spacing:.08em;
      color: rgba(255,255,255,.95);
      margin-bottom:6px;
    }

    .artist-details{
      font-size:11px;
      color: rgba(255,255,255,.60);
      display:flex;
      gap:12px;
      flex-wrap:wrap;
    }

    .artist-actions{
      display:flex;
      gap:8px;
    }

    .success{
      margin-top:16px;
      padding:12px 16px;
      border-radius:10px;
      background: rgba(0,255,0,.12);
      border:1px solid rgba(0,255,0,.25);
      color: rgba(255,255,255,.90);
      font-size:12px;
      text-align:center;
      display:none;
    }

    .success.show{
      display:block;
    }

    .json-viewer{
      margin-top:16px;
      padding:16px;
      border-radius:10px;
      background: rgba(0,0,0,.45);
      border:1px solid rgba(255,255,255,.10);
      font-family: 'Courier New', monospace;
      font-size:11px;
      color: rgba(255,255,255,.80);
      max-height:200px;
      overflow-y:auto;
      white-space:pre-wrap;
      word-break:break-all;
    }

    .btn-group{
      display:flex;
      gap:12px;
      margin-top:12px;
      flex-wrap:wrap;
    }

    .stat-card{
      padding:18px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.35);
    }

    .stat-card h3{
      margin:0 0 8px 0;
      font-size:11px;
      letter-spacing:.14em;
      text-transform:uppercase;
      color: rgba(255,255,255,.70);
      font-weight:700;
    }

    .stat-card .value{
      font-size:24px;
      font-weight:900;
      color: rgba(255,255,255,.95);
      text-shadow: 0 0 20px rgba(255,0,0,.25);
    }

    .logout-btn{
      margin-top:24px;
      padding:10px 16px;
      background: rgba(255,0,0,.08);
      border:1px solid rgba(255,0,0,.20);
      color: rgba(255,255,255,.80);
      border-radius:8px;
      font-size:11px;
      letter-spacing:.12em;
      text-transform:uppercase;
      cursor:pointer;
      transition: all 0.2s ease;
      width:100%;
    }

    .logout-btn:hover{
      background: rgba(255,0,0,.15);
      border-color: rgba(255,0,0,.30);
    }

    .grain, .scratches, .blood, .drips{
      position:absolute;
      pointer-events:none;
      z-index:4;
    }

    .grain{
      inset:-25%;
      opacity:.14;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='240' height='240'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.92' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='240' height='240' filter='url(%23n)' opacity='.55'/%3E%3C/svg%3E");
      background-size:240px 240px;
      mix-blend-mode: overlay;
      animation: grainMove 7s steps(8) infinite;
    }
    @keyframes grainMove{
      0%{ transform: translate3d(-2%, -2%, 0); }
      50%{ transform: translate3d(2%, 1%, 0); }
      100%{ transform: translate3d(-2%, -2%, 0); }
    }

    .scratches{
      inset:0;
      opacity:.12;
      background:
        repeating-linear-gradient(
          90deg,
          rgba(255,255,255,.028) 0px,
          rgba(255,255,255,0) 2px,
          rgba(255,255,255,0) 24px
        );
      mix-blend-mode: screen;
      animation: scratch 4.1s infinite;
    }
    @keyframes scratch{
      0%,100%{ transform: translateX(0); opacity:.10; }
      40%{ transform: translateX(-1px); opacity:.15; }
      72%{ transform: translateX(1px); opacity:.12; }
    }

    .blood{
      inset:-10%;
      opacity:.34;
      background:
        radial-gradient(160px 120px at 12% 22%, rgba(179,0,0,.55), rgba(179,0,0,0) 72%),
        radial-gradient(110px 90px at 18% 28%, rgba(255,0,0,.28), rgba(255,0,0,0) 72%),
        radial-gradient(190px 140px at 86% 20%, rgba(179,0,0,.42), rgba(179,0,0,0) 74%),
        radial-gradient(140px 110px at 82% 28%, rgba(255,0,0,.22), rgba(255,0,0,0) 74%),
        radial-gradient(170px 130px at 78% 84%, rgba(179,0,0,.26), rgba(179,0,0,0) 78%),
        radial-gradient(160px 120px at 24% 86%, rgba(179,0,0,.22), rgba(179,0,0,0) 78%);
      filter: blur(.7px);
      mix-blend-mode: screen;
      animation: bloodBreath 10s ease-in-out infinite;
    }
    @keyframes bloodBreath{
      0%,100%{ transform: translate3d(0,0,0) scale(1); opacity:.28; }
      50%{ transform: translate3d(0,-1%,0) scale(1.01); opacity:.38; }
    }

    .drips{
      inset:0;
      opacity:.28;
      background:
        radial-gradient(70px 260px at 46% 0%, rgba(255,0,0,.20), rgba(255,0,0,0) 72%),
        radial-gradient(50px 220px at 52% 0%, rgba(179,0,0,.18), rgba(179,0,0,0) 76%),
        radial-gradient(34px 180px at 58% 0%, rgba(255,0,0,.14), rgba(255,0,0,0) 78%),
        radial-gradient(26px 160px at 40% 0%, rgba(179,0,0,.12), rgba(179,0,0,0) 80%);
      filter: blur(.9px);
      mix-blend-mode: screen;
      animation: dripShift 12.5s ease-in-out infinite;
    }
    @keyframes dripShift{
      0%,100%{ transform: translateY(0); opacity:.22; }
      50%{ transform: translateY(7px); opacity:.34; }
    }

    @media (max-width: 520px){
      .login-card{ padding:28px 24px; }
    }

    @media (prefers-reduced-motion: reduce){
      .grain, .scratches, .blood, .drips{ animation:none !important; }
    }
  </style>
</head>

<body>
  <div class="stage">
    <div class="center">
      
      <!-- Login Form -->
      <div id="loginForm" class="login-card">
        <h1>Admin Panel</h1>
        <p class="subtitle">Login</p>
        
        <form id="loginFormElement" onsubmit="handleLogin(event)">
          <div class="form-group">
            <label for="username">Username</label>
            <input type="text" id="username" name="username" required autocomplete="off">
          </div>
          
          <div class="form-group">
            <label for="password">Password</label>
            <input type="password" id="password" name="password" required autocomplete="off">
          </div>
          
          <button type="submit" class="btn">Login</button>
        </form>
        
        <div id="error" class="error"></div>
      </div>

      <!-- Dashboard -->
      <div id="dashboard" class="dashboard-card dashboard">
        <div class="dashboard-header">
          <h2>Admin Dashboard</h2>
          <p>Welcome, Admin</p>
        </div>
        
        <div class="dashboard-content">
          <div class="stat-card">
            <h3>Total Artists</h3>
            <div class="value" id="artistCount">-</div>
          </div>
          
          <div class="stat-card">
            <h3>Last Update</h3>
            <div class="value" style="font-size:14px;" id="lastUpdate">-</div>
          </div>

          <!-- Add Artist Section -->
          <div class="section">
            <h3 class="section-title">Add New Artist</h3>
            <form id="addArtistForm" onsubmit="handleAddArtist(event)">
              <div class="form-row">
                <div class="form-group">
                  <label for="artistName">Artist Name *</label>
                  <input type="text" id="artistName" name="name" required>
                </div>
                <div class="form-group">
                  <label for="artistMonthlyListeners">Monthly Listeners</label>
                  <input type="number" id="artistMonthlyListeners" name="monthlyListeners" placeholder="e.g. 50000" min="0">
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label for="artistProfile">Artist Profile Image</label>
                  <input type="file" id="artistProfile" name="profile" accept="image/*" onchange="handleImagePreview(event)">
                  <div id="imagePreview" class="image-preview">
                    <img id="previewImg" src="" alt="Preview">
                  </div>
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label for="artistInstagram">Instagram URL</label>
                  <input type="url" id="artistInstagram" name="instagram" placeholder="https://instagram.com/...">
                </div>
                <div class="form-group">
                  <label for="artistSpotify">Spotify URL</label>
                  <input type="url" id="artistSpotify" name="spotify" placeholder="https://open.spotify.com/...">
                </div>
              </div>
              <button type="submit" class="btn">Add Artist</button>
            </form>
            <div id="addSuccess" class="success"></div>
          </div>

          <!-- Artists List Section -->
          <div class="section">
            <h3 class="section-title">Current Artists</h3>
            <div id="artistsList" class="artists-list">
              <div style="text-align:center; color:rgba(255,255,255,.55); padding:20px;">
                Loading...
              </div>
            </div>
          </div>

          <!-- JSON Export Section -->
          <div class="section">
            <h3 class="section-title">JSON File</h3>
            <p style="font-size:11px; color:rgba(255,255,255,.60); margin-bottom:12px;">
              Download the updated JSON file and replace the artists.json file.
            </p>
            <div id="jsonViewer" class="json-viewer"></div>
            <div class="btn-group">
              <button class="btn-secondary" onclick="copyJSON()">Copy JSON</button>
              <button class="btn-secondary" onclick="downloadJSON()">Download JSON</button>
            </div>
          </div>
        </div>
        
        <button class="logout-btn" onclick="handleLogout()" style="margin-top:24px;">Logout</button>
      </div>

    </div>

    <div class="blood" aria-hidden="true"></div>
    <div class="drips" aria-hidden="true"></div>
    <div class="grain" aria-hidden="true"></div>
    <div class="scratches" aria-hidden="true"></div>
  </div>

  <script>
    const SESSION_KEY = 'admin_session';
    
    // Encoded credentials (obfuscated)
    const _0x1a2b = atob('YWRtaW4=');
    const _0x3c4d = 'e2e39d5772d9b6ab7f12db91564b37d5f23ea057d7898eb213eba20f0cc68450';

    async function _0x5e6f(str) {
      const msgBuffer = new TextEncoder().encode(str);
      const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
      const hashArray = Array.from(new Uint8Array(hashBuffer));
      return hashArray.map(b => ('00' + b.toString(16)).slice(-2)).join('');
    }

    // Check if already logged in
    if (sessionStorage.getItem(SESSION_KEY) === 'authenticated') {
      showDashboard();
    }

    async function handleLogin(e) {
      e.preventDefault();
      const username = document.getElementById('username').value.trim();
      const password = document.getElementById('password').value;
      const errorEl = document.getElementById('error');

      const pwdHash = await _0x5e6f(password);
      if (username === _0x1a2b && pwdHash === _0x3c4d) {
        sessionStorage.setItem(SESSION_KEY, 'authenticated');
        showDashboard();
        errorEl.classList.remove('show');
      } else {
        errorEl.textContent = 'Invalid username or password!';
        errorEl.classList.add('show');
        setTimeout(() => {
          errorEl.classList.remove('show');
        }, 3000);
      }
    }

    let artistsData = { artists: [] };

    function showDashboard() {
      document.getElementById('loginForm').style.display = 'none';
      document.getElementById('dashboard').classList.add('active');
      loadDashboardData();
    }

    const STORAGE_KEY = 'artists_data';

    async function loadDashboardData() {
      // ALWAYS prioritize localStorage - admin panel data stays persistent
      const storedData = localStorage.getItem(STORAGE_KEY);
      if (storedData) {
        try {
          artistsData = JSON.parse(storedData);
          if (!Array.isArray(artistsData.artists)) {
            artistsData.artists = [];
          }
          // Ensure data structure is correct
          if (!artistsData.artists) {
            artistsData.artists = [];
          }
          updateUI();
          return; // Don't load from JSON if localStorage has data
        } catch (e) {
          console.error('Error parsing localStorage data:', e);
          // If localStorage is corrupted, clear it and load from JSON
          localStorage.removeItem(STORAGE_KEY);
        }
      }

      // Only load from JSON file if localStorage is empty
      try {
        const res = await fetch('./artists.json', { cache: 'no-store' });
        if (res.ok) {
          artistsData = await res.json();
          if (!Array.isArray(artistsData.artists)) {
            artistsData.artists = [];
          }
          // Save to localStorage for persistence
          saveToLocalStorage();
          updateUI();
        } else {
          // If JSON doesn't exist, initialize empty
          artistsData = { artists: [] };
          saveToLocalStorage();
          updateUI();
        }
      } catch (e) {
        // If fetch fails, initialize empty
        artistsData = { artists: [] };
        saveToLocalStorage();
        updateUI();
      }
    }

    function saveToLocalStorage() {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(artistsData));
      } catch (e) {
        console.error('Error saving to localStorage:', e);
      }
    }

    function updateUI() {
      const artistCount = artistsData.artists.length;
      document.getElementById('artistCount').textContent = artistCount;
      
      const now = new Date();
      document.getElementById('lastUpdate').textContent = 
        now.toLocaleString('en-US', { 
          day: '2-digit', 
          month: '2-digit', 
          year: 'numeric',
          hour: '2-digit',
          minute: '2-digit'
        });

      renderArtistsList();
      updateJSONViewer();
    }

    function renderArtistsList() {
      const listEl = document.getElementById('artistsList');
      
      if (artistsData.artists.length === 0) {
        listEl.innerHTML = '<div style="text-align:center; color:rgba(255,255,255,.55); padding:20px;">No artists added yet.</div>';
        return;
      }

      listEl.innerHTML = artistsData.artists.map((artist, index) => {
        const profileImg = artist.profile ? `<img src="${escapeHTML(artist.profile)}" alt="${escapeHTML(artist.name)}" style="width:50px;height:50px;border-radius:8px;object-fit:cover;margin-right:12px;">` : '';
        return `
        <div class="artist-item">
          <div class="artist-info" style="display:flex;align-items:center;">
            ${profileImg}
            <div>
              <div class="artist-name">${escapeHTML(artist.name || 'Unnamed')}</div>
              <div class="artist-details">
                ${artist.monthlyListeners ? `<span>${formatNumber(artist.monthlyListeners)} monthly listeners</span>` : ''}
              </div>
            </div>
          </div>
          <div class="artist-actions">
            <button class="btn-edit" onclick="editArtist(${index})">Edit</button>
            <button class="btn-danger" onclick="deleteArtist(${index})">Delete</button>
          </div>
        </div>
        <div id="editForm${index}" class="edit-form">
          <form onsubmit="handleUpdateArtist(event, ${index})">
            <div class="form-row">
              <div class="form-group">
                <label>Artist Name *</label>
                <input type="text" id="editName${index}" value="${escapeHTML(artist.name || '')}" required>
              </div>
              <div class="form-group">
                <label>Monthly Listeners</label>
                <input type="number" id="editListeners${index}" value="${artist.monthlyListeners || ''}" min="0">
              </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                  <label>Profile Image</label>
                  <input type="file" id="editProfile${index}" accept="image/*" onchange="handleEditImagePreview(event, ${index})">
                  <div id="editImagePreview${index}" class="image-preview" ${artist.profile ? 'style="display:block;"' : ''}>
                    ${artist.profile ? `<img id="editPreviewImg${index}" src="${escapeHTML(artist.profile)}" alt="Preview">` : ''}
                  </div>
                </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label>Instagram URL</label>
                <input type="url" id="editInstagram${index}" value="${escapeHTML(artist.instagram || '')}" placeholder="https://instagram.com/...">
              </div>
              <div class="form-group">
                <label>Spotify URL</label>
                <input type="url" id="editSpotify${index}" value="${escapeHTML(artist.spotify || '')}" placeholder="https://open.spotify.com/...">
              </div>
            </div>
            <div style="display:flex;gap:8px;margin-top:12px;">
              <button type="submit" class="btn-secondary">Update</button>
              <button type="button" class="btn-secondary" onclick="cancelEdit(${index})">Cancel</button>
            </div>
          </form>
        </div>
      `;
      }).join('');
    }

    function formatNumber(num) {
      if (!num) return '';
      return new Intl.NumberFormat('en-US').format(num);
    }

    function updateJSONViewer() {
      const jsonStr = JSON.stringify(artistsData, null, 2);
      document.getElementById('jsonViewer').textContent = jsonStr;
    }

    function escapeHTML(str) {
      if (!str) return '';
      return String(str)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#039;');
    }

    let profileImageBase64 = '';

    function handleImagePreview(event) {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          profileImageBase64 = e.target.result;
          const previewEl = document.getElementById('imagePreview');
          const imgEl = document.getElementById('previewImg');
          imgEl.src = profileImageBase64;
          previewEl.classList.add('show');
        };
        reader.readAsDataURL(file);
      }
    }

    function handleAddArtist(e) {
      e.preventDefault();
      const form = e.target;
      const formData = new FormData(form);
      
      const newArtist = {
        name: formData.get('name').trim(),
        monthlyListeners: formData.get('monthlyListeners') ? parseInt(formData.get('monthlyListeners')) : null,
        profile: profileImageBase64 || '',
        instagram: formData.get('instagram')?.trim() || '',
        spotify: formData.get('spotify')?.trim() || ''
      };

      if (!newArtist.name) {
        showMessage('addSuccess', 'Please enter artist name!', false);
        return;
      }

      artistsData.artists.push(newArtist);
      saveToLocalStorage(); // Save to localStorage immediately
      form.reset();
      profileImageBase64 = '';
      document.getElementById('imagePreview').classList.remove('show');
      document.getElementById('previewImg').src = '';
      updateUI();
      showMessage('addSuccess', 'Artist added successfully!', true);
    }

    let editingIndex = -1;
    let editProfileImageBase64 = '';

    function editArtist(index) {
      // Close any other open edit forms
      document.querySelectorAll('.edit-form').forEach(form => {
        form.classList.remove('active');
      });
      
      editingIndex = index;
      const editForm = document.getElementById(`editForm${index}`);
      editForm.classList.add('active');
      editForm.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }

    function cancelEdit(index) {
      editingIndex = -1;
      editProfileImageBase64 = '';
      document.getElementById(`editForm${index}`).classList.remove('active');
    }

    function handleEditImagePreview(event, index) {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          editProfileImageBase64 = e.target.result;
          const previewEl = document.getElementById(`editImagePreview${index}`);
          let imgEl = document.getElementById(`editPreviewImg${index}`);
          if (!imgEl) {
            imgEl = document.createElement('img');
            imgEl.id = `editPreviewImg${index}`;
            imgEl.alt = 'Preview';
            previewEl.appendChild(imgEl);
          }
          imgEl.src = editProfileImageBase64;
          previewEl.classList.add('show');
        };
        reader.readAsDataURL(file);
      }
    }

    function handleUpdateArtist(e, index) {
      e.preventDefault();
      const artist = artistsData.artists[index];
      
      const updatedArtist = {
        name: document.getElementById(`editName${index}`).value.trim(),
        monthlyListeners: document.getElementById(`editListeners${index}`).value ? parseInt(document.getElementById(`editListeners${index}`).value) : null,
        profile: editProfileImageBase64 || artist.profile || '',
        instagram: document.getElementById(`editInstagram${index}`).value.trim() || '',
        spotify: document.getElementById(`editSpotify${index}`).value.trim() || ''
      };

      if (!updatedArtist.name) {
        showMessage('addSuccess', 'Please enter artist name!', false);
        return;
      }

      artistsData.artists[index] = updatedArtist;
      saveToLocalStorage();
      editingIndex = -1;
      editProfileImageBase64 = '';
      updateUI();
      showMessage('addSuccess', 'Artist updated successfully!', true);
    }

    function deleteArtist(index) {
      if (confirm('Are you sure you want to delete this artist?')) {
        artistsData.artists.splice(index, 1);
        saveToLocalStorage(); // Save to localStorage immediately
        updateUI();
        showMessage('addSuccess', 'Artist deleted!', true);
      }
    }

    function showMessage(elementId, message, isSuccess) {
      const el = document.getElementById(elementId);
      el.textContent = message;
      el.className = isSuccess ? 'success show' : 'error show';
      setTimeout(() => {
        el.classList.remove('show');
      }, 3000);
    }

    function copyJSON() {
      const jsonStr = JSON.stringify(artistsData, null, 2);
      navigator.clipboard.writeText(jsonStr).then(() => {
        showMessage('addSuccess', 'JSON copied!', true);
      }).catch(() => {
        showMessage('addSuccess', 'Copy failed!', false);
      });
    }

    function downloadJSON() {
      const jsonStr = JSON.stringify(artistsData, null, 2);
      const blob = new Blob([jsonStr], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'artists.json';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      showMessage('addSuccess', 'JSON file downloaded!', true);
    }

    function handleLogout() {
      sessionStorage.removeItem(SESSION_KEY);
      document.getElementById('loginForm').style.display = 'block';
      document.getElementById('dashboard').classList.remove('active');
      document.getElementById('username').value = '';
      document.getElementById('password').value = '';
    }
  </script>
</body>
</html>

